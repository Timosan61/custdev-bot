# Правила для Claude при работе с проектом custdev-bot

## Общие правила
1. **Язык общения**: Всегда отвечать на русском языке
2. **Перезапуск бота**: После любых изменений в коде бота автоматически:
   - Остановить бота: `./stop_bot.sh`
   - Запустить заново: `./start_bot.sh`
3. **Мониторинг после запуска**: После запуска бота автоматически переходить в режим мониторинга:
   - Показывать логи: `tail -30 bot_runtime.log`
   - Отслеживать ошибки и сообщать о них
   - Предлагать исправления при обнаружении проблем
4. **Работа с базой данных**: ВСЕГДА использовать MCP Supabase для любых операций с БД:
   - Используй `mcp__supabase__execute_sql` для выполнения SQL запросов
   - Используй `mcp__supabase__list_tables` для просмотра структуры БД
   - НЕ используй прямое подключение к БД через Python
   - НЕ создавай скрипты для работы с БД напрямую

## Структура проекта
- `src/` - основной код бота
  - `agents/` - агенты для исследователей и респондентов
  - `bot/` - обработчики и middleware
  - `services/` - сервисы (Supabase, Zep, Voice)
  - `state/` - FSM состояния
  - `utils/` - утилиты и клавиатуры
  - `prompts/` - шаблоны промптов

## API ключи
Все ключи хранятся в `.env` файле:
- TELEGRAM_BOT_TOKEN
- OPENAI_API_KEY
- SUPABASE_URL
- SUPABASE_KEY
- ZEP_API_KEY

## Основные команды
- Запуск бота: `python3 -m src.main`
- Установка зависимостей: `pip install -r requirements.txt`
- Проверка логов: бот использует loguru для логирования

## Особенности реализации
- Голосовые сообщения обрабатываются через OpenAI Whisper
- Контекст диалогов хранится в Zep Cloud
- Данные интервью сохраняются в Supabase
- FSM для управления состояниями диалога